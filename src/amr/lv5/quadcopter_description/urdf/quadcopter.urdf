<?xml version="1.0"?>
<robot name="quadcopter">
    <link name="base_link">
        <visual>
            <geometry>
                <mesh filename="package://quadcopter_description/urdf/meshes/x3.dae" scale="1 1 1"/>
            </geometry>
        </visual>
        <collision>
            <geometry>
                <box size="0.47 0.47 0.11"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="1.5"/>
            <inertia ixx="0.0347563" iyy="0.07" izz="0.0977" ixy="0" ixz="0" iyz="0"/>
        </inertial>
    </link>

    <link name="rotor_0">
        <visual>
            <geometry>
                <mesh filename="package://quadcopter_description/urdf/meshes/propeller_ccw.dae" scale="0.1 0.1 0.1"/>
            </geometry>
            <material name="blue">
                <color rgba="0 0 1.0 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.005" radius="0.1"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="0.005"/>
            <inertia ixx="9.75e-07" iyy="4.17041e-05" izz="4.26041e-05" ixy="0" ixz="0" iyz="0"/>
            <mass>0.005</mass>
        </inertial>
    </link>
    <joint name="rotor_0_joint" type="continuous">
        <axis xyz="0 0 1"/>
        <parent link="base_link"/>
        <child link="rotor_0"/>
        <origin xyz="0.126 -0.22 0.033" rpy="0 -0 0"/>
    </joint>

    <link name="rotor_1">
        <visual>
            <geometry>
                <mesh filename="package://quadcopter_description/urdf/meshes/propeller_ccw.dae" scale="0.1 0.1 0.1"/>
            </geometry>
            <material name="red">
                <color rgba="1.0 0 0 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.005" radius="0.1"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="0.005"/>
            <inertia ixx="9.75e-07" iyy="4.17041e-05" izz="4.26041e-05" ixy="0" ixz="0" iyz="0"/>
            <mass>0.005</mass>
        </inertial>
    </link>
    <joint name="rotor_1_joint" type="continuous">
        <axis xyz="0 0 1"/>
        <parent link="base_link"/>
        <child link="rotor_1"/>
        <origin xyz="-0.134 0.2 0.033" rpy="0 -0 0"/>
    </joint>

    <link name="rotor_2">
        <visual>
            <geometry>
                <mesh filename="package://quadcopter_description/urdf/meshes/propeller_cw.dae" scale="0.1 0.1 0.1"/>
            </geometry>
            <material name="blue">
                <color rgba="0 0 1.0 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.005" radius="0.1"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="0.005"/>
            <inertia ixx="9.75e-07" iyy="4.17041e-05" izz="4.26041e-05" ixy="0" ixz="0" iyz="0"/>
            <mass>0.005</mass>
        </inertial>
    </link>
    <joint name="rotor_2_joint" type="continuous">
        <axis xyz="0 0 1"/>
        <parent link="base_link"/>
        <child link="rotor_2"/>
        <origin xyz="0.126 0.22 0.033" rpy="0 -0 0"/>
    </joint>
    
    <link name="rotor_3">
        <visual>
            <geometry>
                <mesh filename="package://quadcopter_description/urdf/meshes/propeller_cw.dae" scale="0.1 0.1 0.1"/>
            </geometry>
            <material name="red">
                <color rgba="1.0 0 0 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <cylinder length="0.005" radius="0.1"/>
            </geometry>
        </collision>
        <inertial>
            <mass value="0.005"/>
            <inertia ixx="9.75e-07" iyy="4.17041e-05" izz="4.26041e-05" ixy="0" ixz="0" iyz="0"/>
            <mass>0.005</mass>
        </inertial>
    </link>
    <joint name="rotor_3_joint" type="continuous">
        <axis xyz="0 0 1"/>
        <parent link="base_link"/>
        <child link="rotor_3"/>
        <origin xyz="-0.134 -0.2 0.033" rpy="0 -0 0"/>
    </joint>

    <link name="rgb_camera_frame"/>
    <joint name="camera_joint" type="fixed">
        <parent link="base_link"/>
        <child link="rgb_camera_frame"/>
        <origin xyz="0.110 0 0" rpy="0 0 0"/>
    </joint>

    <link name="rgb_camera_optical_frame"/>
    <joint name="camera_joint_optical" type="fixed">
        <parent link="rgb_camera_frame"/>
        <child link="rgb_camera_optical_frame"/>
        <origin xyz="0 0 0" rpy="-1.57 0 -1.57"/>
    </joint>

    <gazebo reference="rotor_0">
            <material>Gazebo/Blue</material>
    </gazebo>
    <gazebo reference="rotor_1">
            <material>Gazebo/Red</material>
    </gazebo>
    <gazebo reference="rotor_2">
            <material>Gazebo/Blue</material>
    </gazebo>
    <gazebo reference="rotor_3">
            <material>Gazebo/Red</material>
    </gazebo>

    <gazebo reference="rgb_camera_frame">
        <sensor name="camera" type="camera">
          <camera>
            <camera_info_topic>camera/camera_info</camera_info_topic>
            <horizontal_fov>1.44164</horizontal_fov>
            <image>
              <width>960</width>
              <height>720</height>
              <format>R8G8B8</format>
            </image>
            <clip>
              <near>0.1</near>
              <far>100</far>
            </clip>
          </camera>
          <always_on>1</always_on>
          <update_rate>30</update_rate>
          <visualize>true</visualize>
          <topic>camera/image</topic>
          <gz_frame_id>rgb_camera_frame</gz_frame_id>
        </sensor>
    </gazebo>

    <gazebo>
        <plugin filename="gz-sim-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
            <robotNamespace>quadcopter</robotNamespace>
            <jointName>rotor_0_joint</jointName>
            <linkName>rotor_0</linkName>
            <turningDirection>ccw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>800.0</maxRotVelocity>
            <motorConstant>8.54858e-06</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>gazebo/command/motor_speed</commandSubTopic>
            <motorNumber>0</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <motorSpeedPubTopic>motor_speed/0</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>
    </gazebo>
    
    <gazebo>
        <plugin filename="gz-sim-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
            <robotNamespace>quadcopter</robotNamespace>
            <jointName>rotor_1_joint</jointName>
            <linkName>rotor_1</linkName>
            <turningDirection>ccw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>800.0</maxRotVelocity>
            <motorConstant>8.54858e-06</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>gazebo/command/motor_speed</commandSubTopic>
            <motorNumber>1</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <motorSpeedPubTopic>motor_speed/1</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>
    </gazebo>

    <gazebo>
        <plugin filename="gz-sim-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
            <robotNamespace>quadcopter</robotNamespace>
            <jointName>rotor_2_joint</jointName>
            <linkName>rotor_2</linkName>
            <turningDirection>cw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>800.0</maxRotVelocity>
            <motorConstant>8.54858e-06</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>gazebo/command/motor_speed</commandSubTopic>
            <motorNumber>2</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <motorSpeedPubTopic>motor_speed/2</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>
    </gazebo>

    <gazebo>
        <plugin filename="gz-sim-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
            <robotNamespace>quadcopter</robotNamespace>
            <jointName>rotor_3_joint</jointName>
            <linkName>rotor_3</linkName>
            <turningDirection>cw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>800.0</maxRotVelocity>
            <motorConstant>8.54858e-06</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>gazebo/command/motor_speed</commandSubTopic>
            <motorNumber>3</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <motorSpeedPubTopic>motor_speed/3</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>
    </gazebo>

    <gazebo>
        <plugin filename="gz-sim-multicopter-control-system" name="gz::sim::systems::MulticopterVelocityControl">
            <robotNamespace>quadcopter</robotNamespace>
            <commandSubTopic>cmd_vel</commandSubTopic>
            <enableSubTopic>enable</enableSubTopic>
            <comLinkName>base_link</comLinkName>
            <velocityGain>2.7 2.7 2.7</velocityGain>
            <attitudeGain>2 3 0.15</attitudeGain>
            <angularRateGain>0.4 0.52 0.18</angularRateGain>
            <maximumLinearAcceleration>2 2 2</maximumLinearAcceleration>
            <rotorConfiguration>
                <rotor>
                    <jointName>rotor_0_joint</jointName>
                    <forceConstant>8.54858e-06</forceConstant>
                    <momentConstant>0.016</momentConstant>
                    <direction>1</direction>
                </rotor>
                <rotor>
                    <jointName>rotor_1_joint</jointName>
                    <forceConstant>8.54858e-06</forceConstant>
                    <momentConstant>0.016</momentConstant>
                    <direction>1</direction>
                </rotor>
                <rotor>
                    <jointName>rotor_2_joint</jointName>
                    <forceConstant>8.54858e-06</forceConstant>
                    <momentConstant>0.016</momentConstant>
                    <direction>-1</direction>
                </rotor>
                <rotor>
                    <jointName>rotor_3_joint</jointName>
                    <forceConstant>8.54858e-06</forceConstant>
                    <momentConstant>0.016</momentConstant>
                    <direction>-1</direction>
                </rotor>
            </rotorConfiguration>
        </plugin>
    </gazebo>

    <gazebo>
        <plugin name="gz::sim::systems::OdometryPublisher" filename = "gz-sim-odometry-publisher-system">
            <odom_frame>odom</odom_frame>
            <robot_base_frame>base_link</robot_base_frame> 
            <odom_topic>odom</odom_topic>
            <tf_topic>tf</tf_topic>
            <dimensions>3</dimensions>
        </plugin>
    </gazebo>

    <gazebo>
        <plugin filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher">
            <topic>joint_states</topic>
            <joint_name>rotor_0_joint</joint_name> 
            <joint_name>rotor_1_joint</joint_name> 
            <joint_name>rotor_2_joint</joint_name>
            <joint_name>rotor_3_joint</joint_name>
        </plugin>
    </gazebo>

</robot>